---
name: docx-to-excel
description: 从Word文档提取结构化数据并生成Excel文件。当需要从.docx文档中提取表格、段落、标题等结构化信息，并转换为Excel格式进行数据分析时使用此技能。
---

# Word文档到Excel转换技能

此技能提供从Word文档提取结构化数据并生成Excel文件的完整工作流程。支持多种提取模式和输出格式。

## 核心功能

1. **文档解析**：读取.docx文件，提取文本、表格、标题结构
2. **数据提取**：支持表格提取、段落提取、正则匹配、自定义字段映射
3. **Excel生成**：创建格式化的Excel文件，支持多工作表、公式、图表
4. **批量处理**：支持处理多个Word文档并合并到单个Excel文件

## 使用场景

当遇到以下情况时使用此技能：
- 从报告文档中提取表格数据到Excel进行分析
- 将合同文档中的关键信息整理成电子表格
- 批量处理多个Word文档并汇总数据
- 需要将文档中的结构化信息转换为可计算格式

## 快速开始

### 基本用法

1. **准备Word文档**：确保.docx文件在可访问的路径
2. **确定提取需求**：明确需要提取的信息类型（表格、段落、特定字段）
3. **运行提取脚本**：使用提供的Python脚本进行数据提取
4. **生成Excel文件**：将提取的数据保存为.xlsx格式

### 示例命令

```bash
# 提取Word文档中的表格数据
python3 scripts/extract_tables.py "path/to/document.docx" --output "output.xlsx"

# 提取特定字段到Excel
python3 scripts/extract_fields.py "path/to/document.docx" --fields "标题,日期,作者" --output "data.xlsx"
```

## 详细工作流程

### 1. 文档分析

首先分析Word文档的结构：
- 使用`python-docx`库读取文档
- 识别文档中的表格、段落、标题层级
- 分析文档布局和内容结构

### 2. 数据提取策略

根据文档类型选择提取策略：

#### 表格提取
- 提取所有表格数据
- 保留表格格式和结构
- 支持合并单元格处理

#### 段落提取
- 按标题层级组织内容
- 提取关键段落信息
- 支持段落过滤和排序

#### 正则表达式匹配
- 使用预定义或自定义正则模式
- 提取特定格式的信息（日期、金额、编号等）
- 支持分组捕获

#### 自定义字段映射
- 用户指定字段名称和提取规则
- 支持XPath式文档定位
- 灵活处理非标准文档结构

### 3. Excel生成选项

#### 基本表格
- 简单的行列数据
- 基本的文本格式

#### 格式化表格
- 单元格样式（字体、颜色、边框）
- 条件格式
- 数据验证

#### 多工作表
- 不同类型数据分表存储
- 工作表间链接
- 汇总工作表

#### 高级功能
- 计算公式
- 数据透视表
- 图表生成

## 脚本使用说明

### extract_tables.py
从Word文档提取所有表格到Excel。

**参数：**
- `--input`: 输入Word文档路径（必需）
- `--output`: 输出Excel文件路径（默认：output.xlsx）
- `--sheet-name`: Excel工作表名称（默认：Tables）
- `--preserve-format`: 保留表格格式（默认：False）

### extract_fields.py
根据自定义字段映射提取数据。

**参数：**
- `--input`: 输入Word文档路径（必需）
- `--output`: 输出Excel文件路径（必需）
- `--fields`: 要提取的字段列表，逗号分隔
- `--config`: 字段映射配置文件路径
- `--template`: Excel模板文件路径

### batch_process.py
批量处理多个Word文档。

**参数：**
- `--input-dir`: 输入目录路径（包含.docx文件）
- `--output`: 输出Excel文件路径
- `--merge`: 合并所有文档数据到单个文件（默认：True）
- `--pattern`: 文件匹配模式（默认：*.docx）

## 配置文件格式

### 字段映射配置（JSON）
```json
{
  "fields": [
    {
      "name": "项目名称",
      "type": "paragraph",
      "location": "标题1[0]",
      "regex": null
    },
    {
      "name": "合同金额",
      "type": "regex",
      "pattern": "金额[:：]\\s*(\\d+(?:\\.\\d+)?)",
      "default": "0"
    },
    {
      "name": "签约日期",
      "type": "table",
      "table_index": 0,
      "row": 1,
      "column": 2
    }
  ]
}
```

### Excel模板配置
- 使用`templates/`目录中的模板文件
- 支持预定义样式和布局
- 可自定义数据填充位置

## 常见问题处理

### 文档格式问题
1. **编码问题**：确保文档使用标准编码
2. **特殊字符**：处理Unicode字符和特殊符号
3. **格式兼容性**：检查.docx版本兼容性

### 数据提取问题
1. **表格识别**：调整表格检测参数
2. **段落分割**：优化段落分割逻辑
3. **字段匹配**：调试正则表达式模式

### Excel生成问题
1. **格式丢失**：检查样式应用逻辑
2. **性能问题**：优化大数据集处理
3. **兼容性**：确保Excel版本兼容

## 最佳实践

### 文档预处理
1. 确保文档结构清晰
2. 统一文档格式标准
3. 清理无关内容和格式

### 提取策略选择
1. 简单表格数据 → 表格提取
2. 结构化报告 → 段落提取
3. 特定格式信息 → 正则匹配
4. 复杂文档 → 自定义字段映射

### 输出优化
1. 使用模板保证一致性
2. 添加数据验证规则
3. 包含元数据和文档信息

## 扩展功能

### 自定义提取器
在`scripts/custom_extractors/`目录中添加自定义提取逻辑。

### 插件系统
支持第三方提取插件和输出格式化器。

### 集成选项
可与数据库、API等其他系统集成。

## 故障排除

### 脚本无法运行
1. 检查Python环境（需要python3.8+）
2. 安装依赖：`pip install python-docx openpyxl pandas`
3. 验证文件路径权限

### 数据提取不完整
1. 检查文档结构
2. 调整提取参数
3. 使用调试模式输出中间结果

### Excel文件问题
1. 检查文件大小限制
2. 验证单元格数据类型
3. 测试不同Excel版本兼容性

## 相关资源

- `references/word_structure.md`：Word文档结构详解
- `references/excel_formats.md`：Excel格式和样式指南
- `templates/`：预定义Excel模板
- `scripts/examples/`：使用示例和测试文件